{"cells": [{"cell_type": "markdown", "id": "a8d12712-5c7b-4acb-bb8b-e73efcb9b5dc", "metadata": {}, "source": ["# \ud83d\udea9 Using `redflag` with Pandas\n", "\n", "As well as using `redflag`'s functions directly (see [`Basic_usage.ipynb`](`./Basic_usage.ipynb`)), or with `sklearn` (see `Using_redflag_with_Pandas.ipynb`), `redflag` has some Pandas 'accessors' that give you access to some `redflag` functions almost as if they were methods on Pandas objects.\n", "\n", "The best way to get the idea is to look at an example.\n", "\n", "First, even though we may not use it directly, we have to import `redflag` to get access to its functions. As long as you have `pandas` installed, it will register the accessors."]}, {"cell_type": "code", "execution_count": 1, "id": "77aa7f67-0bc7-48e9-87f4-183aa2dc2c35", "metadata": {}, "outputs": [{"data": {"text/plain": ["'0.1.10.dev10+gc36a75a.d20221121'"]}, "execution_count": 1, "metadata": {}, "output_type": "execute_result"}], "source": ["import redflag as rf\n", "\n", "rf.__version__"]}, {"cell_type": "code", "execution_count": 2, "id": "3dbcf6e1-1cb5-4ca5-b64a-bc1d9e7b174f", "metadata": {}, "outputs": [{"data": {"text/html": ["<div>\n", "<style scoped>\n", "    .dataframe tbody tr th:only-of-type {\n", "        vertical-align: middle;\n", "    }\n", "\n", "    .dataframe tbody tr th {\n", "        vertical-align: top;\n", "    }\n", "\n", "    .dataframe thead th {\n", "        text-align: right;\n", "    }\n", "</style>\n", "<table border=\"1\" class=\"dataframe\">\n", "  <thead>\n", "    <tr style=\"text-align: right;\">\n", "      <th></th>\n", "      <th>Well Name</th>\n", "      <th>Depth</th>\n", "      <th>Formation</th>\n", "      <th>RelPos</th>\n", "      <th>Marine</th>\n", "      <th>GR</th>\n", "      <th>ILD</th>\n", "      <th>DeltaPHI</th>\n", "      <th>PHIND</th>\n", "      <th>PE</th>\n", "      <th>Facies</th>\n", "      <th>LATITUDE</th>\n", "      <th>LONGITUDE</th>\n", "      <th>ILD_log10</th>\n", "      <th>Lithology</th>\n", "      <th>RHOB</th>\n", "      <th>Mineralogy</th>\n", "      <th>Siliciclastic</th>\n", "    </tr>\n", "  </thead>\n", "  <tbody>\n", "    <tr>\n", "      <th>0</th>\n", "      <td>SHRIMPLIN</td>\n", "      <td>851.3064</td>\n", "      <td>A1 SH</td>\n", "      <td>1.000</td>\n", "      <td>1</td>\n", "      <td>77.45</td>\n", "      <td>4.613176</td>\n", "      <td>9.9</td>\n", "      <td>11.915</td>\n", "      <td>4.6</td>\n", "      <td>3.0</td>\n", "      <td>37.978076</td>\n", "      <td>-100.987305</td>\n", "      <td>0.664</td>\n", "      <td>siltstone</td>\n", "      <td>2393.499945</td>\n", "      <td>siliciclastic</td>\n", "      <td>True</td>\n", "    </tr>\n", "    <tr>\n", "      <th>1</th>\n", "      <td>SHRIMPLIN</td>\n", "      <td>851.4588</td>\n", "      <td>A1 SH</td>\n", "      <td>0.979</td>\n", "      <td>1</td>\n", "      <td>78.26</td>\n", "      <td>4.581419</td>\n", "      <td>14.2</td>\n", "      <td>12.565</td>\n", "      <td>4.1</td>\n", "      <td>3.0</td>\n", "      <td>37.978076</td>\n", "      <td>-100.987305</td>\n", "      <td>0.661</td>\n", "      <td>siltstone</td>\n", "      <td>2416.119814</td>\n", "      <td>siliciclastic</td>\n", "      <td>True</td>\n", "    </tr>\n", "    <tr>\n", "      <th>2</th>\n", "      <td>SHRIMPLIN</td>\n", "      <td>851.6112</td>\n", "      <td>A1 SH</td>\n", "      <td>0.957</td>\n", "      <td>1</td>\n", "      <td>79.05</td>\n", "      <td>4.549881</td>\n", "      <td>14.8</td>\n", "      <td>13.050</td>\n", "      <td>3.6</td>\n", "      <td>3.0</td>\n", "      <td>37.978076</td>\n", "      <td>-100.987305</td>\n", "      <td>0.658</td>\n", "      <td>siltstone</td>\n", "      <td>2404.576056</td>\n", "      <td>siliciclastic</td>\n", "      <td>True</td>\n", "    </tr>\n", "    <tr>\n", "      <th>3</th>\n", "      <td>SHRIMPLIN</td>\n", "      <td>851.7636</td>\n", "      <td>A1 SH</td>\n", "      <td>0.936</td>\n", "      <td>1</td>\n", "      <td>86.10</td>\n", "      <td>4.518559</td>\n", "      <td>13.9</td>\n", "      <td>13.115</td>\n", "      <td>3.5</td>\n", "      <td>3.0</td>\n", "      <td>37.978076</td>\n", "      <td>-100.987305</td>\n", "      <td>0.655</td>\n", "      <td>siltstone</td>\n", "      <td>2393.249071</td>\n", "      <td>siliciclastic</td>\n", "      <td>True</td>\n", "    </tr>\n", "    <tr>\n", "      <th>4</th>\n", "      <td>SHRIMPLIN</td>\n", "      <td>851.9160</td>\n", "      <td>A1 SH</td>\n", "      <td>0.915</td>\n", "      <td>1</td>\n", "      <td>74.58</td>\n", "      <td>4.436086</td>\n", "      <td>13.5</td>\n", "      <td>13.300</td>\n", "      <td>3.4</td>\n", "      <td>3.0</td>\n", "      <td>37.978076</td>\n", "      <td>-100.987305</td>\n", "      <td>0.647</td>\n", "      <td>siltstone</td>\n", "      <td>2382.602601</td>\n", "      <td>siliciclastic</td>\n", "      <td>True</td>\n", "    </tr>\n", "  </tbody>\n", "</table>\n", "</div>"], "text/plain": ["   Well Name     Depth Formation  RelPos  Marine     GR       ILD  DeltaPHI  \\\n", "0  SHRIMPLIN  851.3064     A1 SH   1.000       1  77.45  4.613176       9.9   \n", "1  SHRIMPLIN  851.4588     A1 SH   0.979       1  78.26  4.581419      14.2   \n", "2  SHRIMPLIN  851.6112     A1 SH   0.957       1  79.05  4.549881      14.8   \n", "3  SHRIMPLIN  851.7636     A1 SH   0.936       1  86.10  4.518559      13.9   \n", "4  SHRIMPLIN  851.9160     A1 SH   0.915       1  74.58  4.436086      13.5   \n", "\n", "    PHIND   PE  Facies   LATITUDE   LONGITUDE  ILD_log10  Lithology  \\\n", "0  11.915  4.6     3.0  37.978076 -100.987305      0.664  siltstone   \n", "1  12.565  4.1     3.0  37.978076 -100.987305      0.661  siltstone   \n", "2  13.050  3.6     3.0  37.978076 -100.987305      0.658  siltstone   \n", "3  13.115  3.5     3.0  37.978076 -100.987305      0.655  siltstone   \n", "4  13.300  3.4     3.0  37.978076 -100.987305      0.647  siltstone   \n", "\n", "          RHOB     Mineralogy  Siliciclastic  \n", "0  2393.499945  siliciclastic           True  \n", "1  2416.119814  siliciclastic           True  \n", "2  2404.576056  siliciclastic           True  \n", "3  2393.249071  siliciclastic           True  \n", "4  2382.602601  siliciclastic           True  "]}, "execution_count": 2, "metadata": {}, "output_type": "execute_result"}], "source": ["import pandas as pd\n", "\n", "df = pd.read_csv('https://geocomp.s3.amazonaws.com/data/Panoma_training_data.csv')\n", "\n", "df.head()"]}, {"cell_type": "markdown", "id": "98f5c772-a33d-43cf-82cf-54dc21535133", "metadata": {}, "source": ["For the time being, there are only accessors on Pandas `Series` objects. For example:"]}, {"cell_type": "code", "execution_count": 3, "id": "1b17a7e8-1d28-4e1b-9b7d-ecdbbe750aaf", "metadata": {}, "outputs": [], "source": ["# Call the Series s for simplicity:\n", "s = df['Lithology']"]}, {"cell_type": "markdown", "id": "52e5e4e1-9200-46b2-9d77-9cc0d2cbc4a8", "metadata": {}, "source": ["Now we can call the `redflag` function `imbalance_degree()` as if it were a method (but notice the extra `redflag` we have to insert to access the method):"]}, {"cell_type": "code", "execution_count": 4, "id": "6af691f4-90a3-4a8e-b842-a20f70c72314", "metadata": {}, "outputs": [{"data": {"text/plain": ["3.378593040846633"]}, "execution_count": 4, "metadata": {}, "output_type": "execute_result"}], "source": ["s.redflag.imbalance_degree()"]}, {"cell_type": "markdown", "id": "f2ea6821-0610-44b4-a855-653642ea089d", "metadata": {}, "source": ["Or we can ask for the new 'dummy' scores:"]}, {"cell_type": "code", "execution_count": 5, "id": "5897e460-cc15-4858-939b-b91b19fafc9f", "metadata": {}, "outputs": [{"data": {"text/plain": ["{'f1': 0.23675633692130837,\n", " 'roc_auc': 0.5016874730299105,\n", " 'strategy': 'stratified',\n", " 'task': 'classification'}"]}, "execution_count": 5, "metadata": {}, "output_type": "execute_result"}], "source": ["s.redflag.dummy_scores()"]}, {"cell_type": "markdown", "id": "3b9be98e-5642-4bab-80eb-f4c226422781", "metadata": {}, "source": ["Let's try that on a regression target like `df['RHOB']`"]}, {"cell_type": "code", "execution_count": 6, "id": "f734bb50-15e9-43c3-b31f-1a078e398dc3", "metadata": {}, "outputs": [{"data": {"text/plain": ["{'mean_squared_error': 47528.78263092096,\n", " 'r2': 0.0,\n", " 'strategy': 'mean',\n", " 'task': 'regression'}"]}, "execution_count": 6, "metadata": {}, "output_type": "execute_result"}], "source": ["df['RHOB'].redflag.dummy_scores()"]}, {"cell_type": "markdown", "id": "381501a1-8944-4b3f-a4cf-d80e08fbac4f", "metadata": {}, "source": ["Or we can ask for a 'report' (very simple for now):"]}, {"cell_type": "code", "execution_count": 7, "id": "02380595-2b47-4718-9b58-ef6b170f29b1", "metadata": {}, "outputs": [{"name": "stdout", "output_type": "stream", "text": ["Continuous data suitable for regression\n", "Outliers:    [  34   35  140  141  142  143  175  532  581  583  633  662  757  768\n", "  769  801 1316 1547 1744 1754 1756 1778 1779 1780 1784 1785 1788 1808\n", " 1812 2884 2932 2973 2974 3004 3087 3094 3109]\n", "Correlated:  True\n", "Dummy scores:{'mean': {'mean_squared_error': 47528.78263092096, 'r2': 0.0}}\n", "\n"]}], "source": ["print(df['RHOB'].redflag.report())"]}, {"cell_type": "markdown", "id": "e007d9b8-4346-4d9a-93a5-45222a137248", "metadata": {}, "source": ["This is an experimental feature; future releases will have more functions. Feedback welcome!"]}], "metadata": {"kernelspec": {"display_name": "Python 3 (ipykernel)", "language": "python", "name": "python3"}, "language_info": {"codemirror_mode": {"name": "ipython", "version": 3}, "file_extension": ".py", "mimetype": "text/x-python", "name": "python", "nbconvert_exporter": "python", "pygments_lexer": "ipython3", "version": "3.11.5"}}, "nbformat": 4, "nbformat_minor": 5}